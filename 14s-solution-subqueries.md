# Exercise: Subqueries

Write a SQL query for each of the following prompts

1. Compute the total amount of revenue generated by the sales person with the highest number of all-time sales. (`sales.salesorderheader` and `sales.salesorderdetail`, you'll need a group by in both the subquery AND the main query.)

```sql
select 
  sum(unitprice*orderqty) as total_rev
from sales.salesorderdetail sod
join sales.salesorderheader soh on soh.salesorderid=sod.salesorderid
where soh.salespersonid = (select salespersonid 
						   from sales.salesorderheader 
						   group by salespersonid 
						   order by count(salespersonid) desc 
						   limit 1);
```

2. Select every `sale.salesorderdetail` whose `orderqty` is within 1 units (in either direction) of the average `orderqty`.

```sql
select 
  * 
from sales.salesorderdetail
where orderqty < ((select avg(orderqty) from sales.salesorderdetail) + 1) 
  and orderqty > ((select avg(orderqty) from sales.salesorderdetail) - 1);
```

3. Select every `person.address` which comes from the least common two countries (based on the values in `person.address` not based on sales data or anything else).

```sql
select * from person.address a
join person.stateprovince sp on sp.stateprovinceid=a.stateprovinceid
where sp.countryregioncode in (
	select countryregioncode from person.address a
	join person.stateprovince sp on sp.stateprovinceid=a.stateprovinceid
	group by countryregioncode
	order by count(countryregioncode) asc
	limit 2
);
```